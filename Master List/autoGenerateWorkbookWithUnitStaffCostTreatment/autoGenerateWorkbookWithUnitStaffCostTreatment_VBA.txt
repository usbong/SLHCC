Sub autoGenerateWorkbookWithUnitStaffCostTreatment()
' Copyright 2019 Usbong Social Systems, Inc.
'
' Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You ' may obtain a copy of the License at
'
' http://www.apache.org/licenses/LICENSE-2.0
'
' Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, ' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing ' permissions and limitations under the License.
'
' @author: Michael Syson
' @date created: 20190626
' @date updated: 20190626
'
' Given:
' 1) Workbook's worksheet with the transactions data for the Month
'
'Output:
' 1) Auto-generated new Workbook with the automatically computed Unit Staff Cost
'
Dim myInput As Worksheet
Dim myOutput As Worksheet 'the same as myInput
Dim outputPath As String 'added by Mike, 20190329
Dim startDateString As String 'added by Mike, 20190329
Dim endDateString As String

Dim row As Range
Dim RowCount As Integer
Dim TableHeaderRowUtilization As Integer
Dim TableHeaderRow As Integer
Dim LastPrintableRow As Integer
Dim MaxPatientNameColumnWidth As Integer
Dim patientNameFontSize As Integer

'added by Mike, 20190325
Dim INPUT_NON_MASTER_LIST_OFFSET As Integer
Dim MS_EXCEL_OFFSET As Integer

Dim INPUT_REFERRING_DOCTOR_COLUMN As Integer
Dim INPUT_NOTES_COLUMN As Integer
Dim INPUT_DATE_COLUMN As Integer
Dim INPUT_PATIENT_NAME_COLUMN As Integer
Dim INPUT_CLASS_COLUMN As Integer
Dim INPUT_NET_PF_COLUMN As Integer
Dim INPUT_NEW_OLD_COLUMN As Integer
Dim INPUT_NEW_OLD_PATIENT_COLUMN As Integer
Dim INPUT_CHARGE_SLIP_NUMBER_COLUMN As Integer
Dim INPUT_APPROVAL_CODE_COLUMN As Integer
Dim INPUT_FEE_COLUMN As Integer
Dim INPUT_DIAGNOSIS_COLUMN As Integer
Dim INPUT_PT_NAME_COLUMN As Integer

Dim OUTPUT_TOTAL_COLUMNS As Integer
Dim OUTPUT_UNIT_STAFF_COST_DATE_COLUMN As Integer
Dim OUTPUT_UNIT_STAFF_COST_PT_NAME_COLUMN As Integer
Dim OUTPUT_UNIT_STAFF_COST_PT_NAME_NOTE_COLUMN As Integer
Dim OUTPUT_UNIT_STAFF_COST_PT_TRANSACTION_SERVICE_COUNT_COLUMN As Integer
Dim OUTPUT_UNIT_STAFF_COST_PT_TRANSACTION_SERVICE_COST_COLUMN As Integer
Dim OUTPUT_UNIT_STAFF_COST_PT_TRANSACTION_SERVICE_TOTAL_COUNT_COLUMN As Integer
Dim OUTPUT_UNIT_STAFF_COST_PT_TRANSACTION_SERVICE_TOTAL_COST_COLUMN As Integer
Dim OUTPUT_UNIT_STAFF_COST_TOTAL_PT_TRANSACTION_SERVICE_TOTAL_COUNT_COLUMN As Integer
Dim OUTPUT_UNIT_STAFF_COST_TOTAL_PT_TRANSACTION_SERVICE_TOTAL_COST_COLUMN As Integer

'set the values of the defined terms, i.e. value-holders
INPUT_NON_MASTER_LIST_OFFSET = 0
MS_EXCEL_OFFSET = 1 'added by Mike, 20190325
INPUT_DATE_COLUMN = 0 - INPUT_NON_MASTER_LIST_OFFSET + MS_EXCEL_OFFSET
INPUT_PT_NAME_COLUMN = 16 - INPUT_NON_MASTER_LIST_OFFSET + MS_EXCEL_OFFSET
    
OUTPUT_TOTAL_COLUMNS = 15 + MS_EXCEL_OFFSET
OUTPUT_UNIT_STAFF_COST_DATE_COLUMN = 0 + MS_EXCEL_OFFSET
OUTPUT_UNIT_STAFF_COST_PT_NAME_COLUMN = 1 + MS_EXCEL_OFFSET
OUTPUT_UNIT_STAFF_COST_PT_NAME_NOTE_COLUMN = 2 + MS_EXCEL_OFFSET
OUTPUT_UNIT_STAFF_COST_PT_TRANSACTION_SERVICE_COUNT_COLUMN = 8 + MS_EXCEL_OFFSET
OUTPUT_UNIT_STAFF_COST_PT_TRANSACTION_SERVICE_COST_COLUMN = 9 + MS_EXCEL_OFFSET
OUTPUT_UNIT_STAFF_COST_PT_TRANSACTION_SERVICE_TOTAL_COUNT_COLUMN = 10 + MS_EXCEL_OFFSET
OUTPUT_UNIT_STAFF_COST_PT_TRANSACTION_SERVICE_TOTAL_COST_COLUMN = 11 + MS_EXCEL_OFFSET
OUTPUT_UNIT_STAFF_COST_TOTAL_PT_TRANSACTION_SERVICE_TOTAL_COUNT_COLUMN = 12 + MS_EXCEL_OFFSET
OUTPUT_UNIT_STAFF_COST_TOTAL_PT_TRANSACTION_SERVICE_TOTAL_COST_COLUMN = 13 + MS_EXCEL_OFFSET
    
'added by Mike, 20190328
'TableHeaderRowUtilization = 6

'added by Mike, 20190330
'TableHeaderRow = 5

'added by Mike, 20190324
Dim unitStaffCostContainer As Collection
Set unitStaffCostContainer = New Collection

Dim unitStaffCostColumnValuesContainer As Collection
'Set hmoBillingColumnValuesContainer = New Collection

unitStaffCostContainerTransactionCount = 1
RowCount = 1 '2 'do not include table header row
RowCountOffset = 0 'This is to make the add-on software automatically adjust to rows with new line marks
OutputRowCount = 1 'added by Mike, 20190325

'added by Mike, 20190328
'Application.ScreenUpdating = False

Set myInput = Sheets(ActiveSheet.name)

'   ImportTextFilesAsWorksheetsInWorkbookUtilizationHMOMarch2019_20190301~20190308

'Set myOutput = Sheets(ActiveSheet.name)


'added by Mike, 20190328
'Set unitStaffCostTableHeaderContainer = New Collection

'unitStaffCostTableHeaderContainer.Add "DATE", CStr(1) 'convert 1 to a String to be accepted as key
'unitStaffCostTableHeaderContainer.Add "PATIENT'S NAME", CStr(2)
'unitStaffCostTableHeaderContainer.Add "HMO NAME", CStr(3)
'unitStaffCostTableHeaderContainer.Add "DIAGNOSIS", CStr(4)
'unitStaffCostTableHeaderContainer.Add "MD'S SIGNATURE", CStr(5)
'unitStaffCostTableHeaderContainer.Add "RECEIVED BY/DATE", CStr(6)

For Each row In myInput.Rows
        Set unitStaffCostColumnValuesContainer = New Collection

'        MsgBox ("UCase(Trim(myInput.Cells(RowCount, INPUT_DATE_COLUMN))): " & UCase(Trim(myInput.Cells(RowCount, INPUT_DATE_COLUMN))))
                
        unitStaffCostColumnValuesContainer.Add CDate(UCase(Trim(myInput.Cells(RowCount, INPUT_DATE_COLUMN)))), CStr(OUTPUT_UNIT_STAFF_COST_DATE_COLUMN)
        unitStaffCostColumnValuesContainer.Add UCase(Trim(myInput.Cells(RowCount, INPUT_PT_NAME_COLUMN))), CStr(OUTPUT_UNIT_STAFF_COST_PT_NAME_COLUMN)

        unitStaffCostContainer.Add unitStaffCostColumnValuesContainer, CStr(unitStaffCostContainerTransactionCount)
        unitStaffCostContainerTransactionCount = unitStaffCostContainerTransactionCount + 1

        RowCount = RowCount + 1
                            
        If IsEmpty(myInput.Range("C" & RowCount).Value) Then
            Exit For
'        Else
'            RowCount = RowCount + 1
        End If
Next row

'added by Mike, 20190329
'startDateString = Format(unitStaffCostContainer(1)(CStr(OUTPUT_UNIT_STAFF_COST_DATE_COLUMN)), "yyyymmdd")
'endDateString = Format(unitStaffCostContainer(hmoBillingContainerTransactionCount - 1)(CStr(OUTPUT_UNIT_STAFF_COST_DATE_COLUMN)), "yyyymmdd")

'--------------------------------------------------------------
'Process Output Folders and Files
'--------------------------------------------------------------
outputPath = Application.ActiveWorkbook.path & "\output\"
Set fso = CreateObject("scripting.filesystemobject")
If Not fso.folderexists(outputPath) Then
    fso.createfolder (outputPath)
End If

'--------------------------------------------------------------
'Process HMO Billing Utilization
'--------------------------------------------------------------

'TO-DO: -delete: workbook with the same filename
Set NewWorkbook = Workbooks.Add
    With NewWorkbook
        .SaveAs Filename:=outputPath & "unitStaffCostTreatmentWorkbook" & ".xls" '& startDateString & "~" & endDateString & ".xls"
    End With

outputWorksheetName = "treatment"

NewWorkbook.Sheets.Add.name = outputWorksheetName

RowCount = 1
OutputRowCount = 1

For Each unitStaffCostColumnValuesContainer In unitStaffCostContainer
    'added by Mike, 20190327
    'medicalDoctorName = hmoBillingColumnValuesContainer(CStr(OUTPUT_HMO_BILLING_MEDICAL_DOCTOR_NAME_COLUMN))

    'If a workheet with the outputWorksheetName, i.e. "treatment" name, exists
'    If Evaluate("ISREF('" & outputWorksheetName & "'!A1)") Then
        'write transactions later
        'do nothing for now
    'If a workheet with the outputWorksheetName, i.e. "treatment" name, does not exist
'    Else

'        NewWorkbook.Sheets.Add.name = outputWorksheetName 'edited by Mike, 20190328
                                               
        'medicalDoctorWorksheetOutputRowCountContainer.Add TableHeaderRowUtilization + 1, medicalDoctorName
'        OutputRowCount = TableHeaderRowUtilization + 1
            
        Set myOutput = Sheets(ActiveSheet.name)
    
        'added by Mike, 20190327
        myOutput.Cells(OutputRowCount, OUTPUT_UNIT_STAFF_COST_PT_NAME_COLUMN).Value = unitStaffCostColumnValuesContainer(CStr(OUTPUT_UNIT_STAFF_COST_PT_NAME_COLUMN))
        
        OutputRowCount = OutputRowCount + 1
        
'        'added by Mike, 20190328
'        For i = 1 To hmoUtilizationTableHeaderContainer.Count 'from 1 to the total items in the container
'            myOutput.Cells(TableHeaderRowUtilization, i).Value = hmoUtilizationTableHeaderContainer(i)
'        Next
'    End If
Next unitStaffCostColumnValuesContainer

'added by Mike, 20190328
'delete default worksheet automatically included when we created a new workbook
Application.DisplayAlerts = False 'do not display alert/warning message for delete confirmation
Worksheets("Sheet1").Delete
Application.DisplayAlerts = True


'NewWorkbook.Save
NewWorkbook.Close
'--------------------------------------------------------------

'added by Mike, 20190328
'Application.ScreenUpdating = True

End Sub